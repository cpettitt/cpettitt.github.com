<!doctype html>
<meta charset="utf-8">
<title>Dagre Test Page</title>

<style>
h2 {
  color: #333;
}

.error {
  color: red;
}
</style>

<h2>Graph Definition</h2>

<textarea id="input" rows="5" cols="80" style="display: block" onKeyUp="tryDraw();">
/* Example */
digraph {
    A [label="A Big Source!", fontSize=25];
    C [fontColor=red];
    E [label="A blue sink!", fontName=arial, fill="#aaccff"];
    A -&gt; B -&gt; C [color=green, strokeWidth=3];
    B -&gt; D -&gt; E;
    C -&gt; E;
    A -&gt; D;
}
</textarea>

<h2>Graph Visualization</h2>

<svg width=0 height=0></svg>

<script src="dagre.js"></script>

<script>
  var input = document.querySelector("#input");

  var svgRoot = document.querySelector("svg");

  var graphRE = /[?&]graph=([^&]+)/;
  var graphMatch = window.location.search.match(graphRE);
  if (graphMatch) {
    input.value = decodeURIComponent(graphMatch[1]);
  }

  tryDraw();

  function graphToURL() {
    return [window.location.protocol, '//',
            window.location.host,
            window.location.pathname,
            '?graph=', encodeURIComponent(input.value)].join('');
  }

  var oldInputValue;
  function tryDraw() {
    var g;

    if (oldInputValue !== input.value) {
      oldInputValue = input.value;
      try {
        g = dagre.graph.read(input.value);
      } catch (e) {
        input.setAttribute("class", "error");
      }
    }

    if (g) {
      while (svgRoot.hasChildNodes()) {
        svgRoot.removeChild(svgRoot.lastChild);
      }

      var svg = document.createElementNS("http://www.w3.org/2000/svg", "g");
      svg.setAttribute("transform", "translate(5, 5)");
      svgRoot.appendChild(svg);

      input.setAttribute("class", "");
      dagre.preLayout(g);
      dagre.layout(g);
      dagre.render(g, svg);

      var wh = g.attrs.bbox.split(" ")[1].split(",");
      svgRoot.setAttribute("width", parseInt(wh[0]) + 10);
      svgRoot.setAttribute("height", parseInt(wh[1]) + 10);
    }
  }
</script>
